<!-- 
　日付：2021/04/04
　目的：onbizを使用して、ボタンが押されたら、ブラウザにONと表示するプログラム
　概要： 接続時：有るよ～
        未接続時：ナッシン
        とブラウザに表示する。
        1番ピン：マヨネーズ
        2番ピン：ケチャップ
        3番ピン：金のゴマダレ
        4番ピン：カップ麺
        があるかどうかを監視する。
-->

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script
      src="https://unpkg.com/obniz@3.x/obniz.js"
      crossorigin="anonymous"
    ></script>

    <!-- JQuaryの追加 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- CSSの設定 -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="obniz-debug"></div>
    <div class="container">
      <div class="text-center">
        <h1>オブストゥ</h1>
        <h3>offline</h3>
        <h3>マヨネーズ： <span id="num_1">あるかどうかを表示するよ。</span></h3>
        <h3>ケチャップ： <span id="num_2">あるかどうかを表示するよ。</span></h3>
        <h3>ゴマダレ： <span id="num_3">あるかどうかを表示するよ。</span></h3>
        <h3>カップ麺： <span id="num_4">あるかどうかを表示するよ。</span></h3>
      </div>
    </div>

    <script>
      // 変数宣言
      let i; //カウント用変数
      let bmax; //ボタンの最大数
      let num = []; //num配列の作成
      let button = []; //button配列の作成

      //put your obniz ID
      var obniz = new Obniz("OBNIZ_ID_HERE");

      // 配列を使用してまとめる。
      //during obniz connection(通信開始)
      obniz.onconnect = async function () {
        //buttonを押したときの動作
        // iを1から4まで繰り返す。
        for (i = 1; i <= bmax; i++) {
          // button[i]にobnizのボタンの値を記録
          button[i] = obniz.wired("Button", { signal: i, gnd: 0 });
          // num[i]にid：num1～4を格納
          num[i] = document.getElemntByID("num_" + i);

          //button[i]のON/OFF時の動作
          button[i].onchange = function (pressed) {
            // button[i]が押されている時
            if (pressed === true) {
              // num[i]に有るよ～を入れる。
              num[i].innerHTML = "有るよ～";
              // button[i]が押されて無い時
            } else if (pressed === false) {
              // num[i]にナッシンを入れる
              num[i].innerHTML = "ナッシン";
            }
          };
        }
      };
    </script>
  </body>
</html>
